<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ingredient Box Game</title>
<style>
  :root {
    --bg: #071022;
    --card-bg: #0f1a33;
    --text: #f0f0f0;
    --accent: #ffcc00;
    --button: #1a2a50;
  }
  body {
    margin: 0;
    font-family: sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
  }
  h1 {
    text-align: center;
  }
  .inventory, .recipes, .actions, .trade {
    margin: 1rem 0;
    width: 100%;
    max-width: 500px;
  }
  .inventory div, .recipes div, .trade div {
    display: flex;
    justify-content: space-between;
    padding: 0.3rem 0.5rem;
    background: var(--card-bg);
    margin: 0.2rem 0;
    border-radius: 6px;
  }
  button {
    background: var(--button);
    border: none;
    color: var(--text);
    padding: 0.5rem 1rem;
    margin: 0.2rem;
    border-radius: 6px;
    font-size: 1rem;
    cursor: pointer;
  }
  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  .log {
    max-height: 150px;
    overflow-y: auto;
    width: 100%;
    background: var(--card-bg);
    padding: 0.5rem;
    border-radius: 6px;
    font-size: 0.9rem;
  }
</style>
</head>
<body>
<h1>Ingredient Box Game</h1>
<div class="stats">Points: <span id="points">0</span></div>

<div class="actions">
  <button id="buyBox">Buy Box (10 pts)</button>
  <button id="openBox">Open Box</button>
</div>

<div class="inventory">
  <h3>Inventory</h3>
  <div id="inventoryList"></div>
</div>

<div class="recipes">
  <h3>Recipes</h3>
  <div id="recipeList"></div>
</div>

<div class="trade">
  <h3>Trade</h3>
  <div id="tradeList"></div>
</div>

<div class="log" id="log"></div>

<script>
// Game state
const state = {
  points: 0,
  boxes: 0,
  inventory: {},
  inventoryLimit: 20,
  boxContents: [],
};

// Ingredients and rarity
const INGREDIENTS = [
  {name: "Flour", rarity: "common"},
  {name: "Egg", rarity: "common"},
  {name: "Milk", rarity: "common"},
  {name: "Sugar", rarity: "common"},
  {name: "Cheese", rarity: "rare"},
  {name: "Butter", rarity: "rare"},
  {name: "Chocolate", rarity: "epic"},
  {name: "Vanilla", rarity: "epic"},
];

const RECIPES = [
  {name: "Cake", ingredients: ["Flour","Egg","Sugar"], points: 15},
  {name: "Cheese Omelette", ingredients: ["Egg","Cheese","Milk"], points: 20},
  {name: "Chocolate Milk", ingredients: ["Milk","Chocolate"], points: 25},
];

// Trading rules: trade 5 commons -> 1 rare
const TRADE_RULES = [
  {give: "common", amount: 5, receive: "rare"},
  {give: "rare", amount: 3, receive: "epic"},
];

// Logging
function pushLog(msg){
  const log = document.getElementById("log");
  log.innerHTML = msg + "<br>" + log.innerHTML;
}

// Helpers
function getRarity(ingredient) {
  return INGREDIENTS.find(i => i.name === ingredient).rarity;
}

function addIngredient(name, qty=1){
  const total = Object.values(state.inventory).reduce((a,b)=>a+b,0);
  if(total + qty > state.inventoryLimit){
    pushLog("Inventory full! Cannot add " + name);
    return false;
  }
  state.inventory[name] = (state.inventory[name]||0) + qty;
  renderInventory();
  return true;
}

// Render functions
function renderInventory(){
  const container = document.getElementById("inventoryList");
  container.innerHTML = "";
  for(const [ing, qty] of Object.entries(state.inventory)){
    const div = document.createElement("div");
    div.textContent = `${ing} x${qty}`;
    container.appendChild(div);
  }
}

function renderRecipes(){
  const container = document.getElementById("recipeList");
  container.innerHTML = "";
  RECIPES.forEach(r=>{
    const div = document.createElement("div");
    div.textContent = `${r.name} (${r.points} pts)`;
    const btn = document.createElement("button");
    btn.textContent = "Craft";
    btn.disabled = !r.ingredients.every(i => (state.inventory[i]||0) > 0);
    btn.onclick = ()=>{
      r.ingredients.forEach(i => state.inventory[i]--);
      state.points += r.points;
      document.getElementById("points").textContent = state.points;
      pushLog(`Crafted ${r.name} for ${r.points} pts`);
      renderInventory();
      renderRecipes();
      renderTrade();
    };
    div.appendChild(btn);
    container.appendChild(div);
  });
}

function renderTrade(){
  const container = document.getElementById("tradeList");
  container.innerHTML = "";
  TRADE_RULES.forEach(rule=>{
    const owned = Object.entries(state.inventory)
      .filter(([n,v])=>getRarity(n)===rule.give)
      .reduce((a,[n,v])=>a+v,0);
    const possible = Math.floor(owned / rule.amount);
    if(possible>0){
      const div = document.createElement("div");
      div.textContent = `Trade ${rule.amount} ${rule.give} for 1 ${rule.receive}`;
      const btn = document.createElement("button");
      btn.textContent = "Trade";
      btn.onclick = ()=>{
        let left = rule.amount;
        for(const [n,v] of Object.entries(state.inventory)){
          if(getRarity(n)===rule.give && left>0){
            const use = Math.min(v,left);
            state.inventory[n]-=use;
            left -= use;
          }
        }
        // pick a random ingredient of receive rarity
        const candidates = INGREDIENTS.filter(i=>i.rarity===rule.receive);
        addIngredient(candidates[Math.floor(Math.random()*candidates.length)].name);
        renderInventory();
        renderTrade();
        pushLog(`Traded for a ${rule.receive} ingredient`);
      };
      div.appendChild(btn);
      container.appendChild(div);
    }
  });
}

// Box mechanics
function openBox(){
  if(state.boxContents.length===0){
    pushLog("No boxes to open!");
    return;
  }
  const box = state.boxContents.shift();
  pushLog(`Opened box: ${box.join(", ")}`);
  box.forEach(i=>addIngredient(i));
  renderTrade();
}

function buyBox(){
  if(state.points<10){
    pushLog("Not enough points to buy a box!");
    return;
  }
  state.points -= 10;
  document.getElementById("points").textContent = state.points;
  // generate a box 2-4 ingredients
  const count = 2 + Math.floor(Math.random()*3);
  const box = [];
  for(let i=0;i<count;i++){
    // weighted random by rarity
    const rand = Math.random();
    let candidates;
    if(rand<0.6) candidates = INGREDIENTS.filter(i=>i.rarity==="common");
    else if(rand<0.9) candidates = INGREDIENTS.filter(i=>i.rarity==="rare");
    else candidates = INGREDIENTS.filter(i=>i.rarity==="epic");
    box.push(candidates[Math.floor(Math.random()*candidates.length)].name);
  }
  state.boxContents.push(box);
  pushLog("Bought a new box!");
}

document.getElementById("buyBox").onclick = buyBox;
document.getElementById("openBox").onclick = openBox;

// Initial render
renderInventory();
renderRecipes();
renderTrade();
</script>
</body>
</html>
